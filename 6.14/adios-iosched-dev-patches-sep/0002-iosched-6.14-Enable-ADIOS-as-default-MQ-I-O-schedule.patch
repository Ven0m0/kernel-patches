From aafe93e2d87b5d5c39576686d781145a517fc030 Mon Sep 17 00:00:00 2001
From: Piotr Gorski <lucjan.lucjanov@gmail.com>
Date: Wed, 23 Apr 2025 08:09:13 +0200
Subject: [PATCH 2/2] iosched-6.14: Enable ADIOS as default MQ I/O scheduler

Source: https://github.com/firelzrd/adios/issues/4

Signed-off-by: Piotr Gorski <lucjan.lucjanov@gmail.com>
---
 block/Kconfig.iosched | 7 +++++++
 block/elevator.c      | 4 ++++
 2 files changed, 11 insertions(+)

diff --git a/block/Kconfig.iosched b/block/Kconfig.iosched
index 79fd5da5d..d89b92e63 100644
--- a/block/Kconfig.iosched
+++ b/block/Kconfig.iosched
@@ -25,6 +25,13 @@ config MQ_IOSCHED_ADIOS
 	  It aims to provide low latency for synchronous requests while
 	  maintaining high throughput for asynchronous requests and bulk I/O.
 
+config MQ_IOSCHED_DEFAULT_ADIOS
+	bool "Enable ADIOS I/O scheduler as default MQ I/O scheduler"
+	depends on MQ_IOSCHED_ADIOS
+	default n
+	help
+	  Enable the ADIOS I/O scheduler as the default scheduler for MQ I/O.
+
 config IOSCHED_BFQ
 	tristate "BFQ I/O scheduler"
 	select BLK_ICQ
diff --git a/block/elevator.c b/block/elevator.c
index cd2ce4921..bfba65c39 100644
--- a/block/elevator.c
+++ b/block/elevator.c
@@ -558,7 +558,11 @@ static struct elevator_type *elevator_get_default(struct request_queue *q)
 
 	if (q->nr_hw_queues != 1 &&
 	    !blk_mq_is_shared_tags(q->tag_set->flags))
+#if defined(CONFIG_MQ_IOSCHED_ADIOS) && defined(CONFIG_MQ_IOSCHED_DEFAULT_ADIOS)
+		return(elevator_find_get("adios"));
+#else
 		return NULL;
+#endif
 
 	return elevator_find_get("mq-deadline");
 }
-- 
2.49.0

