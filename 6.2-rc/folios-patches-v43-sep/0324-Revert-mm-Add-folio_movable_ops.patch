From 8964d06fc802757d5f95475f01fd841a19b04a17 Mon Sep 17 00:00:00 2001
From: Piotr Gorski <lucjan.lucjanov@gmail.com>
Date: Wed, 25 Jan 2023 19:18:59 +0100
Subject: [PATCH 324/353] Revert "mm: Add folio_movable_ops()"

This reverts commit e90f83470db1948205771a34d2cf7752ed4cb62f.

Signed-off-by: Piotr Gorski <lucjan.lucjanov@gmail.com>
---
 include/linux/migrate.h | 9 ---------
 mm/migrate.c            | 2 +-
 2 files changed, 1 insertion(+), 10 deletions(-)

diff --git a/include/linux/migrate.h b/include/linux/migrate.h
index c88b96b48..7376074f2 100644
--- a/include/linux/migrate.h
+++ b/include/linux/migrate.h
@@ -123,15 +123,6 @@ static inline bool folio_test_movable(struct folio *folio)
 	return PageMovable(&folio->page);
 }
 
-static inline
-const struct movable_operations *folio_movable_ops(struct folio *folio)
-{
-	VM_BUG_ON(!__folio_test_movable(folio));
-
-	return (const struct movable_operations *)
-		((unsigned long)folio->mapping - PAGE_MAPPING_MOVABLE);
-}
-
 static inline
 const struct movable_operations *page_movable_ops(struct page *page)
 {
diff --git a/mm/migrate.c b/mm/migrate.c
index 0104151b6..ccef4dc28 100644
--- a/mm/migrate.c
+++ b/mm/migrate.c
@@ -973,7 +973,7 @@ static int move_to_new_folio(struct folio *dst, struct folio *src,
 			goto out;
 		}
 
-		mops = folio_movable_ops(src);
+		mops = page_movable_ops(&src->page);
 		rc = mops->migrate_page(&dst->page, &src->page, mode);
 		WARN_ON_ONCE(rc == MIGRATEPAGE_SUCCESS &&
 				!folio_test_isolated(src));
-- 
2.39.0.rc2.1.gbd5df96b79

