From b18843df208da909a48baece88272b1519f24276 Mon Sep 17 00:00:00 2001
From: Oleksandr Natalenko <oleksandr@natalenko.name>
Date: Tue, 27 Dec 2022 10:37:55 +0100
Subject: [PATCH 2/2] bbr2-6.2: use get_random_u32_below() instead of
 deprecated function

Signed-off-by: Oleksandr Natalenko <oleksandr@natalenko.name>
---
 net/ipv4/tcp_bbr2.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/net/ipv4/tcp_bbr2.c b/net/ipv4/tcp_bbr2.c
index 488429f0f3d0..85f8052144d1 100644
--- a/net/ipv4/tcp_bbr2.c
+++ b/net/ipv4/tcp_bbr2.c
@@ -1775,10 +1775,10 @@ static void bbr2_pick_probe_wait(struct sock *sk)
 
 	/* Decide the random round-trip bound for wait until probe: */
 	bbr->rounds_since_probe =
-		prandom_u32_max(bbr->params.bw_probe_rand_rounds);
+		get_random_u32_below(bbr->params.bw_probe_rand_rounds);
 	/* Decide the random wall clock bound for wait until probe: */
 	bbr->probe_wait_us = bbr->params.bw_probe_base_us +
-			     prandom_u32_max(bbr->params.bw_probe_rand_us);
+			     get_random_u32_below(bbr->params.bw_probe_rand_us);
 }
 
 static void bbr2_set_cycle_idx(struct sock *sk, int cycle_idx)
-- 
2.39.0.rc2.1.gbd5df96b79

