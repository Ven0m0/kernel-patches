From 05d1f520cbca1b6a43491aa0f8fc3d03d1c60156 Mon Sep 17 00:00:00 2001
From: Matthew Wilcox <willy@infradead.org>
Date: Thu, 15 Jun 2023 19:32:26 +0100
Subject: [PATCH 27/32] buffer-convert-block_truncate_page-to-use-a-folio-fix

fix check of filemap_grab_folio() return value

Link: https://lkml.kernel.org/r/ZItZOt+XxV12HtzL@casper.infradead.org
Signed-off-by: Matthew Wilcox <willy@infradead.org>
Cc: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
---
 fs/buffer.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/fs/buffer.c b/fs/buffer.c
index 5a5b0c9d9..248968dbd 100644
--- a/fs/buffer.c
+++ b/fs/buffer.c
@@ -2617,8 +2617,8 @@ int block_truncate_page(struct address_space *mapping,
 	iblock = (sector_t)index << (PAGE_SHIFT - inode->i_blkbits);
 	
 	folio = filemap_grab_folio(mapping, index);
-	if (!folio)
-		return -ENOMEM;
+	if (IS_ERR(folio))
+		return PTR_ERR(folio);
 
 	bh = folio_buffers(folio);
 	if (!bh) {
-- 
2.41.0

