From 91bc913e1efdcc4dd24267002df4aaf3ce5ccd5b Mon Sep 17 00:00:00 2001
From: Nhat Pham <nphamcs@gmail.com>
Date: Wed, 3 May 2023 19:20:44 -0700
Subject: [PATCH 04/14] cachestat: implement cachestat syscall (fix)

This fixlet replaces rounddown logic with the existing helper.

Link: https://lkml.kernel.org/r/20230504022044.3675469-1-nphamcs@gmail.com
Fixes: 5c289a59b1d0 ("cachestat: implement cachestat syscall")
Signed-off-by: Nhat Pham <nphamcs@gmail.com>
Suggested-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
---
 mm/filemap.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/mm/filemap.c b/mm/filemap.c
index bdf884287..2d3d70c64 100644
--- a/mm/filemap.c
+++ b/mm/filemap.c
@@ -4157,8 +4157,7 @@ static void filemap_cachestat(struct address_space *mapping,
 			int order = xa_get_order(xas.xa, xas.xa_index);
 
 			nr_pages = 1 << order;
-			/* rounds down to the nearest multiple of 2^order */
-			folio_first_index = xas.xa_index >> order << order;
+			folio_first_index = round_down(xas.xa_index, 1 << order);
 			folio_last_index = folio_first_index + nr_pages - 1;
 
 			/* Folios might straddle the range boundaries, only count covered pages */
-- 
2.40.1.445.gf85cd430b1

