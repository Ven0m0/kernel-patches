From 1827c9f6b868c1914813cebe78685bd4a51c30bf Mon Sep 17 00:00:00 2001
From: Paolo Valente <paolo.valente@linaro.org>
Date: Fri, 22 Jan 2021 09:38:57 +0100
Subject: [PATCH 22/55] block, bfq, DEBUG: log better_to_idle in
 handle_idle_busy_switch

Signed-off-by: Paolo Valente <paolo.valente@linaro.org>
---
 block/bfq-iosched.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/block/bfq-iosched.c b/block/bfq-iosched.c
index 1a90e2b1c..c662b0e8c 100644
--- a/block/bfq-iosched.c
+++ b/block/bfq-iosched.c
@@ -1914,7 +1914,7 @@ static void bfq_bfqq_handle_idle_busy_switch(struct bfq_data *bfqd,
 
 	bfq_add_bfqq_busy(bfqd, bfqq);
 
-	if (bfqd->in_service_queue)
+	if (bfqd->in_service_queue) {
 		bfq_log_bfqq(bfqd, bfqq,
 			     "wants to preempt %d, higher %d, may preempt %d",
 			     bfqq_wants_to_preempt,
@@ -1923,7 +1923,10 @@ static void bfq_bfqq_handle_idle_busy_switch(struct bfq_data *bfqd,
 							     in_service_queue),
 			     next_queue_may_preempt(bfqd)
 			);
-	else
+		bfq_log_bfqq(bfqd, bfqq,
+			     "better_to_idle %d",
+			     bfq_better_to_idle(bfqd->in_service_queue));
+	} else
 		bfq_log_bfqq(bfqd, bfqq,
 			     "no queue in service");
 
-- 
2.30.0.155.g66e871b664

