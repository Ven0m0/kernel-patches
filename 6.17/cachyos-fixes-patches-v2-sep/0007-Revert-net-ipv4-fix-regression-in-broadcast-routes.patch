From ee1d66c7754f4f53466e1a4b3a2d8f5a7950bc60 Mon Sep 17 00:00:00 2001
From: Eric Naim <dnaim@cachyos.org>
Date: Tue, 9 Sep 2025 10:31:50 +0800
Subject: [PATCH 7/7] Revert "net: ipv4: fix regression in broadcast routes"

This reverts commit ea15c585f1207eb82fdd2b82eb8ed8da92419c3b.

Signed-off-by: Eric Naim <dnaim@cachyos.org>
---
 net/ipv4/route.c | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

diff --git a/net/ipv4/route.c b/net/ipv4/route.c
index 05a5d1858..baa43e596 100644
--- a/net/ipv4/route.c
+++ b/net/ipv4/route.c
@@ -2592,7 +2592,6 @@ static struct rtable *__mkroute_output(const struct fib_result *res,
 	do_cache = true;
 	if (type == RTN_BROADCAST) {
 		flags |= RTCF_BROADCAST | RTCF_LOCAL;
-		fi = NULL;
 	} else if (type == RTN_MULTICAST) {
 		flags |= RTCF_MULTICAST | RTCF_LOCAL;
 		if (!ip_check_mc_rcu(in_dev, fl4->daddr, fl4->saddr,
@@ -2662,12 +2661,8 @@ static struct rtable *__mkroute_output(const struct fib_result *res,
 			rth->dst.output = ip_mc_output;
 			RT_CACHE_STAT_INC(out_slow_mc);
 		}
-		if (type == RTN_BROADCAST && res->fi) {
-			/* ensure MTU value for broadcast routes is retained */
-			ip_dst_init_metrics(&rth->dst, res->fi->fib_metrics);
-		}
 #ifdef CONFIG_IP_MROUTE
-		else if (type == RTN_MULTICAST) {
+		if (type == RTN_MULTICAST) {
 			if (IN_DEV_MFORWARD(in_dev) &&
 			    !ipv4_is_local_multicast(fl4->daddr)) {
 				rth->dst.input = ip_mr_input;
-- 
2.51.0

